"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var t=e(require("del")),n=e(require("gulp")),a=e(require("path")),i=e(require("commander")),r=e(require("single-line-log")),p=e(require("gulp-load-plugins")),s=e(require("fs-extra")),o=e(require("strip-json-comments")),c=e(require("parse5")),u=e(require("gulp-strip-comments"));const{program:l}=i;l.option("--scope <type>","运行目录",process.cwd()).option("--plugin","插件模式"),l.parse(process.argv);const f=l.scope,g=function(){return require.apply(null,arguments)}(a.resolve(f,"./projectToSubPackageConfig")),w=g.wxResourcePath||"src/wxresource",d=g.wxResourceAlias||"@wxResource",h=RegExp(d+"\\/","g"),m=g.uniRequireApiName||"__uniRequireWx",x=RegExp(m+"\\(([a-zA-Z.\\/\"'@\\d]+)\\)","g"),v=g.uniImportWxssApiName||"__uniWxss",P=RegExp(`(}|^|\\s|;)${v}\\s*{([^{}]+)}`,"g");let y="dev";"production"===process.env.NODE_ENV&&(y="build");const k="dist/"+y+"/mp-weixin";let b="dist/"+y+"/mp-weixin-pack";l.plugin&&(b="dist/"+y+"/mp-weixin-pack-plugin");var j={program:l,cwd:f,projectToSubPackageConfig:g,wxResourcePath:w,wxResourceAlias:d,regExpWxResources:h,uniRequireApiName:m,regExpUniRequire:x,uniImportWxssApiName:v,regExpUniImportWxss:P,configWxResourceKey:g.configWxResourceKey||"wxResource",env:y,base:k,target:b,basePath:a.resolve(f,k),subModePath:a.resolve(f,b,g.subPackagePath),targetPath:a.resolve(f,b),packIsSubpackage:{mode:!1}};let S;const _=r.stdout;var L={tryAgain:async function(e){return new Promise(async t=>{setTimeout(async()=>{t(await e())},100)})},getLevelPath:function(e){return Array(e).fill("../").join("")},getLevel:function(e){return e.split(/[\\/]/).length-1},writeLastLine:function(e){_(e),clearTimeout(S),S=setTimeout(()=>{_("解耦构建，正在监听中......(此过程如果出现权限问题，请使用管理员权限运行)")},300)}};const{basePath:A}=j,{tryAgain:E}=L;n.task("clean:base",(async function e(n){try{await t([A+"/**/*"],{force:!0})}catch(t){return void await E(async()=>{await e(n)})}n()}));const{subModePath:R}=j,{tryAgain:C}=L;n.task("clean:subModePath",(async function e(n){try{await t([R+"/**/*"],{force:!0})}catch(t){return void await C(async()=>{await e(n)})}n()}));const{targetPath:N}=j,{tryAgain:W}=L;n.task("clean:previewDist",(async function e(n){try{await t([N+"/**/*"],{force:!0})}catch(t){return void await W(async()=>{await e(n)})}n()}));const M=p(),{cwd:J,projectToSubPackageConfig:q,target:B,env:O}=j,{writeLastLine:$}=L;n.task("watch:pluginJson",(function(){return n.src("src/plugin.json",{allowEmpty:!0,cwd:J}).pipe(M.if("dev"===O,M.watch("src/plugin.json",{cwd:J},(function(e){$("处理"+e.relative+"......")})))).pipe(n.dest(B+"/"+q.subPackagePath,{cwd:J}))}));const I=p(),{cwd:U,target:F,env:T}=j,{writeLastLine:D}=L;n.task("watch:projectConfigJson",(function(){return n.src("project.config.json",{allowEmpty:!0,cwd:U}).pipe(I.if("dev"===T,I.watch("project.config.json",{cwd:U},(function(e){D("处理"+e.relative+"......")})))).pipe(n.dest(F,{cwd:U}))}));const{program:H,cwd:K,projectToSubPackageConfig:z,basePath:V,subModePath:Z,targetPath:G,packIsSubpackage:Q}=j;var X=function(){if(H.plugin)return;const e=a.resolve(K,z.mainWeixinMpPath+"/app.js");if(s.existsSync(e)){const t=s.readFileSync(e,"utf8");let n=`require('${`./${z.subPackagePath}/`}app.js');\n`;if(Z===G){n=s.readFileSync(V+"/app.js","utf8")+";\n"}(Q.mode||H.plugin)&&(n=""),s.outputFileSync(G+"/app.js",n+t)}};const Y=p(),{program:ee,cwd:te,projectToSubPackageConfig:ne,configWxResourceKey:ae,base:ie,packIsSubpackage:re}=j,{writeLastLine:pe}=L;var se=function(e){return pe("处理app.json......"),Y.replace(/[\s\S]+/,(function(t){if(ee.plugin&&"mainAppJson"===e)return t;re.mode=!1;let n,i,r,p={};({pagesJson(){try{n=JSON.parse(o(t))}catch(e){n={}}},baseAppJson(){try{i=JSON.parse(t)}catch(e){i={}}},mainAppJson(){try{r=JSON.parse(t)}catch(e){r={}}}})[e]();try{n||(n=JSON.parse(o(s.readFileSync(a.resolve(te,"src/pages.json"),"utf8"))))}catch(e){n={}}try{i||(i=JSON.parse(s.readFileSync(a.resolve(te,ie+"/app.json"),"utf8")))}catch(e){i={}}try{r||(r=JSON.parse(s.readFileSync(a.resolve(te,ne.mainWeixinMpPath+"/app.json"),"utf8")))}catch(e){r={}}function c(e){return ne.subPackagePath+(ne.subPackagePath?"/":"")+e}if(r.subPackages){let e=r.subPackages.find(e=>e.root===ne.subPackagePath);if(e){re.mode=!0;let t=[...n[ae]&&n[ae].pages||[],...i.pages||[]];return i.subPackages&&i.subPackages.forEach(e=>{t=[...t,...(e.pages||[]).map(t=>e.root+(e.root?"/":"")+t)]}),n[ae]&&n[ae].subPackages&&n[ae].subPackages.forEach(e=>{t=[...t,...(e.pages||[]).map(t=>e.root+(e.root?"/":"")+t)]}),e.pages=t,X(),delete i.pages,delete i.subPackages,JSON.stringify({...i,...r},null,2)}}i.pages&&i.pages.forEach((e,t)=>{i.pages[t]=c(e)}),i.subPackages&&i.subPackages.forEach(e=>{e.root=c(e.root)}),n[ae]&&(n[ae].pages&&n[ae].pages.forEach((e,t)=>{n[ae].pages[t]=c(e)}),n[ae].subPackages&&n[ae].subPackages.forEach(e=>{e.root=c(e.root)})),i.tabBar&&i.tabBar.list&&i.tabBar.list.forEach(({pagePath:e,iconPath:t,selectedIconPath:n,...a},r)=>{i.tabBar.list[r]={pagePath:e?c(e):"",iconPath:t?c(t):"",selectedIconPath:n?c(n):"",...a}}),p={...i,...r},p.pages=Array.from(new Set([...n.indexPage?[c(n.indexPage)]:[],...r.pages||[],...i.pages||[],...n[ae]&&n[ae].pages||[]]));let u=[],l={};function f(e){e.forEach(e=>{l[e.root]=l[e.root]?Array.from(new Set([...l[e.root],...e.pages])):e.pages})}f(n[ae]&&n[ae].subPackages||[]),f(i.subPackages||[]),f(r.subPackages||[]);for(let e in l)u.push({root:e,pages:l[e]});if(p.subPackages=[...u],i.usingComponents){for(let e in i.usingComponents)i.usingComponents[e]="/"+ne.subPackagePath+i.usingComponents[e];p.usingComponents={...p.usingComponents||{},...i.usingComponents}}return X(),JSON.stringify(p,null,2)}),{skipBinary:!1})};const oe=p(),{cwd:ce,target:ue,env:le}=j,{writeLastLine:fe}=L;n.task("watch:pagesJson",(function(){return n.src("src/pages.json",{allowEmpty:!0,cwd:ce}).pipe(oe.if("dev"===le,oe.watch("src/pages.json",{cwd:ce},(function(e){fe("处理"+e.relative+"......")})))).pipe(se("pagesJson")).pipe(oe.rename("app.json")).pipe(n.dest(ue,{cwd:ce}))}));const ge=p(),{cwd:we,target:de,env:he,base:me}=j,{writeLastLine:xe}=L;n.task("watch:baseAppJson",(function(){return n.src(me+"/app.json",{allowEmpty:!0,cwd:we}).pipe(ge.if("dev"===he,ge.watch(me+"/app.json",{cwd:we},(function(e){xe("处理"+e.relative+"......")})))).pipe(se("baseAppJson")).pipe(n.dest(de,{cwd:we}))}));const ve=p(),{cwd:Pe,target:ye,env:ke,projectToSubPackageConfig:be,program:je}=j,{writeLastLine:Se}=L;n.task("watch:mainAppJson",(function(){let e=be.mainWeixinMpPath;return n.src(e+"/app.json",{allowEmpty:!0,cwd:Pe}).pipe(ve.if("dev"===ke,ve.watch(e+"/app.json",{cwd:Pe},(function(e){Se("处理"+e.relative+"......")})))).pipe(se("mainAppJson")).pipe(n.dest(ye+(je.plugin?"/miniprogram":""),{cwd:Pe}))}));const _e=p(),{cwd:Le,target:Ae,env:Ee,projectToSubPackageConfig:Re,program:Ce,basePath:Ne}=j,{writeLastLine:We}=L;n.task("watch:topMode-mainAppJsAndAppWxss",(function(){let e=Re.mainWeixinMpPath;const t=_e.filter([e+"/app.wxss"],{restore:!0}),a=_e.filter([e+"/app.js"],{restore:!0});return n.src([e+"/app.js",e+"/app.wxss"],{allowEmpty:!0,cwd:Le}).pipe(_e.if("dev"===Ee,_e.watch([e+"/app.js",e+"/app.wxss"],{cwd:Le},(function(e){We("处理"+e.relative+"......")})))).pipe(a).pipe(_e.replace(/^/,(function(e){return s.readFileSync(Ne+"/app.js","utf8")+";\n"}),{skipBinary:!1})).pipe(a.restore).pipe(t).pipe(_e.replace(/^/,(function(e){return s.readFileSync(Ne+"/app.wxss","utf8")+"\n"}),{skipBinary:!1})).pipe(t.restore).pipe(n.dest(Ae+(Ce.plugin?"/miniprogram":""),{cwd:Le}))}));const Me=p(),{cwd:Je,target:qe,env:Be,projectToSubPackageConfig:Oe,base:$e,wxResourcePath:Ie}=j,{writeLastLine:Ue}=L;n.task("watch:mainWeixinMpPackPath",(function(){const e=Oe.mainWeixinMpPath,i=e+"/"+Oe.subPackagePath,r=qe+"/"+Oe.subPackagePath;return n.src([i,i+"/**/*","!"+i+"/pack.config.js"],{allowEmpty:!0,cwd:Je}).pipe(Me.if("dev"===Be,Me.watch([i,i+"/**/*","!/"+i+"/pack.config.js"],{cwd:Je},(function(e){Ue("处理"+e.relative+"......")})))).pipe(Me.filter((function(n){if(!function(e){const t=Oe.mainWeixinMpPath+"/"+Oe.subPackagePath;return!s.existsSync(e.path.replace(a.resolve(Je,t),a.resolve(Je,$e)))&&!s.existsSync(e.path.replace(a.resolve(Je,t),a.resolve(Je,Ie)))}(n))return!1;if("unlink"===n.event){try{t.sync([n.path.replace(a.resolve(Je,e),a.resolve(Je,qe))],{force:!0})}catch(e){}return!1}return!0}))).pipe(n.dest(r,{cwd:Je}))}));const Fe=p(),{cwd:Te,target:De,env:He,projectToSubPackageConfig:Ke,basePath:ze,subModePath:Ve,targetPath:Ze,program:Ge,packIsSubpackage:Qe}=j,{writeLastLine:Xe}=L;n.task("watch:mainWeixinMp",(function(){let e=Ke.mainWeixinMpPath,i=e+"/"+Ke.subPackagePath,r=Fe.filter([e+"/app.js"],{restore:!0});return n.src([e+"/**/*","!"+e+"/app.json","!"+e+"/**/*.json___jb_tmp___","!"+e+"/**/*.wxml___jb_tmp___","!"+e+"/**/*.wxss___jb_tmp___","!"+e+"/**/*.js___jb_tmp___","!"+i+"/**/*"],{base:a.resolve(Te,e),allowEmpty:!0,cwd:Te}).pipe(Fe.if("dev"===He,Fe.watch([e+"/**/*","!/"+e+"/app.json","!/"+i+"/**/*"],{cwd:Te},(function(e){Xe("处理"+e.relative+"......")})))).pipe(Fe.filter((function(n){if("unlink"===n.event){try{t.sync([n.path.replace(a.resolve(Te,e),a.resolve(Te,De))],{force:!0})}catch(e){}return!1}return!0}))).pipe(r).pipe(Fe.replace(/^/,(function(e){if(Qe.mode||Ge.plugin)return"";let t=`./${Ke.subPackagePath}/`;if(Ve===Ze){return fs.readFileSync(ze+"/app.js","utf8")+";\n"}return`require('${t}app.js');\n`}),{skipBinary:!1})).pipe(r.restore).pipe(n.dest(De+(Ge.plugin?"/miniprogram":""),{cwd:Te}))}));var Ye={fakeUniBootstrap:function(e,t,n){wx.__uniapp2wxpack||(wx.__uniapp2wxpack={});var a=wx.__uniapp2wxpack[t.replace("/","")]={__packInit:{}};if(e)for(var i in e)"function"!=typeof e[i]?a.__packInit[i]=e[i]:function(t){a.__packInit[t]=function(){return e[t].apply(e,arguments)}}(i);else e={};if("none"!==n){var r=Page,p=Component,s="",o=1,c=1;"function"==typeof e.onError&&wx.onError((function(){return e.onError.apply(e,arguments)})),"function"==typeof e.onPageNotFound&&wx.onPageNotFound((function(){return e.onPageNotFound.apply(e,arguments)})),"function"==typeof e.onUnhandledRejection&&wx.onUnhandledRejection((function(){return e.onUnhandledRejection.apply(e,arguments)})),wx.onAppRoute((function(a){"top"!==n&&0!==("/"+a.path).indexOf(t+"/")&&(o=1,e.onHide.call(e,wx.getLaunchOptionsSync())),s=a.path})),wx.onAppHide((function(){if("top"===n)return e.onHide.call(e,wx.getLaunchOptionsSync());var a=getCurrentPages();return 0===("/"+a[a.length-1].route).indexOf(t+"/")?(o=1,s="",e.onHide.call(e,wx.getLaunchOptionsSync())):void 0})),wx.onAppShow((function(){"top"===n&&"function"==typeof e.onShow&&e.onShow.call(e,wx.getLaunchOptionsSync()),c&&getApp()&&(getApp().globalData||(getApp().globalData={}),Object.assign(getApp().globalData,e.globalData||{})),c=0})),"top"===n&&c&&"function"==typeof e.onLaunch&&e.onLaunch.call(e,wx.getLaunchOptionsSync()),Page=function(e){return u(e),r.call(this,e)},Component=function(e){return u(e.methods||{}),p.call(this,e)}}function u(a){if("top"!==n){var i=a.onShow;"function"!=typeof e.onShow&&"function"!=typeof e.onLaunch||(a.onShow=function(){var n=getCurrentPages();if(s&&0===("/"+s).indexOf(t+"/")||0!==("/"+n[n.length-1].route).indexOf(t+"/")||(o&&(o=0,e.onLaunch.call(e,wx.getLaunchOptionsSync())),e.onShow.call(e,wx.getLaunchOptionsSync())),"function"==typeof i)return i.apply(this,arguments)})}}},fakeUniBootstrapName:"fakeUniBootstrap"};const et=p(),{regExpWxResources:tt,regExpUniRequire:nt}=j,{getLevelPath:at,getLevel:it}=L;var rt={uniRequireWxResource:function(){return et.replace(nt,(function(e,t,n,a){const i=it(this.file.relative);return console.log(`\n编译${e}--\x3erequire(${t.replace(tt,at(i))})`),`require(${t.replace(tt,at(i))})`}),{skipBinary:!1})}};const pt=p(),{fakeUniBootstrapName:st,fakeUniBootstrap:ot}=Ye,{cwd:ct,env:ut,program:lt,basePath:ft,targetPath:gt,subModePath:wt,base:dt,regExpUniRequire:ht,regExpWxResources:mt,regExpUniImportWxss:xt,wxResourceAlias:vt}=j,{writeLastLine:Pt,getLevel:yt,getLevelPath:kt}=L,{uniRequireWxResource:bt}=rt;n.task("subMode:createUniSubPackage",(function(){s.mkdirsSync(ft);const e=pt.filter([dt+"/common/vendor.js",dt+"/common/main.js",dt+"/common/runtime.js",dt+"/pages/**/*.js"],{restore:!0}),i=pt.filter([dt+"/common/vendor.js"],{restore:!0}),r=pt.filter([dt+"/common/main.js"],{restore:!0}),p=pt.filter([dt+"/**/*.js","!"+dt+"/app.js","!"+dt+"/common/vendor.js","!"+dt+"/common/main.js","!"+dt+"/common/runtime.js"],{restore:!0}),o=pt.filter([dt+"/**/*.wxss","!"+dt+"/app.wxss","!"+dt+"/common/main.wxss"],{restore:!0}),l=pt.filter([dt+"/**/*.wxss","!"+dt+"/app.wxss"],{restore:!0}),f=pt.filter([dt+"/**/*.json"],{restore:!0}),g=pt.filter([dt+"/**/*.wxml"],{restore:!0});return n.src([dt+"/**","!"+dt+"/*.*",dt+"/app.js",dt+"/app.wxss"],{allowEmpty:!0,cwd:ct}).pipe(pt.if("dev"===ut,pt.watch([dt+"/**/*","!/"+dt+"/*.json"],{cwd:ct},(function(e){Pt("处理"+e.relative+"......")})))).pipe(pt.filter((function(e){if(function(e){const t=a.resolve(gt,"app.js"),n=a.resolve(gt,"app.wxss"),i=e.path.replace(ft,wt);return t===i||n===i}(e))return!1;if("unlink"===e.event){try{t.sync([e.path.replace(ft,a.resolve(ct,wt))],{force:!0})}catch(e){}return!1}return!0}))).pipe(g).pipe(pt.replace(/[\s\S]*/,(function(e){const t=c.parse(e);let n=0;const a=t.childNodes[0].childNodes[1];return function e(t,n){n&&(n(t),t.childNodes&&t.childNodes.forEach(t=>{e(t,n)}))}(t,e=>{if("img"===e.nodeName&&(e.nodeName="image",e.tagName="image"),"#text"===e.nodeName&&"wxs"===e.parentNode.nodeName){e.value.replace(ht,(t,a,i,r)=>{const p=yt(this.file.relative),s=a.replace(mt,kt(p)).replace(/['"]/g,"");e.parentNode.attrs.push({name:"src",value:s}),e.parentNode.childNodes=[],n=1,console.log(`\n编译${t}--\x3erequire(${s})`)})}}),n?c.serialize(a):e}),{skipBinary:!1})).pipe(g.restore).pipe(i).pipe(pt.replace(/^/,(function(e){return lt.plugin?"var App=function(packInit){};wx.canIUse=function(){return false};":`var __packConfig=require('../pack.config.js');var App=function(packInit){var ${st}=${""+ot};${st}(packInit,__packConfig.packPath,__packConfig.appMode);};`}),{skipBinary:!1})).pipe(i.restore).pipe(e).pipe(u()).pipe(bt()).pipe(e.restore).pipe(r).pipe(pt.replace(/^/,(function(e){return"var __uniPluginExports={};\n"}),{skipBinary:!1})).pipe(pt.replace(/$/,(function(e){return"\nmodule.exports=__uniPluginExports;"}),{skipBinary:!1})).pipe(r.restore).pipe(p).pipe(pt.replace(/^/,(function(e){if(s.existsSync(a.resolve(ct,"src",this.file.relative)))return e;return`require('${kt(yt(this.file.relative))}app.js');\n`}),{skipBinary:!1})).pipe(p.restore).pipe(f).pipe(pt.replace(/[\s\S]*/,(function(e){if(!s.existsSync(a.resolve(ct,"src",this.file.relative.replace(/json$/,"vue")))&&!s.existsSync(a.resolve(ct,"src",this.file.relative.replace(/json$/,"nvue"))))return e;let t=JSON.parse(""+this.file.contents);for(let e in t.usingComponents)0===t.usingComponents[e].indexOf("/")&&(t.usingComponents[e]=kt(yt(this.file.relative))+t.usingComponents[e].replace(/^\//,""));return JSON.stringify(t)}),{skipBinary:!1})).pipe(f.restore).pipe(l).pipe(pt.stripCssComments()).pipe(pt.replace(xt,(function(e,t,n){let a="",i=yt(this.file.relative);return(n+=";").replace(/\s*import\s*:\s*(('[^\s';]*')|("[^\s";]*"))/g,(function(e,t){a+=`@import ${t.replace(mt,kt(i))};\n`})),t+a}),{skipBinary:!1})).pipe(l.restore).pipe(o).pipe(pt.stripCssComments()).pipe(pt.replace(/^[\s\S]*$/,(function(e){if(wt===gt)return e;let t=yt(this.file.relative);return"@import "+('"'+vt+'/app.wxss";').replace(mt,kt(t))+("\n"+e)}),{skipBinary:!1})).pipe(o.restore).pipe(n.dest(wt,{cwd:ct}))}));const jt=p(),{cwd:St,env:_t,targetPath:Lt,subModePath:At,regExpWxResources:Et,regExpUniImportWxss:Rt,wxResourceAlias:Ct,wxResourcePath:Nt}=j,{writeLastLine:Wt,getLevel:Mt,getLevelPath:Jt}=L,{uniRequireWxResource:qt}=rt;n.task("subMode:copyWxResource",(function(){const e=jt.filter([Nt+"/**/*.js"],{restore:!0}),i=jt.filter([Nt+"/**/*.wxss"],{restore:!0});return n.src([Nt+"/**",Nt],{allowEmpty:!0,cwd:St}).pipe(jt.if("dev"===_t,jt.watch([Nt+"/**",Nt,`!/${Nt}/**/*.*___jb_tmp___`],{cwd:St},(function(e){Wt("处理"+e.relative+"......")})))).pipe(e).pipe(jt.replace(/^/,(function(e){return`require('${Jt(Mt(this.file.relative))}app.js');\n`}),{skipBinary:!1})).pipe(u()).pipe(qt()).pipe(e.restore).pipe(i).pipe(jt.stripCssComments()).pipe(jt.replace(Rt,(function(e,t,n){let a="";Mt(this.file.relative);return t+a}),{skipBinary:!1})).pipe(jt.replace(/^[\s\S]*$/,(function(e){if(At===Lt)return e;let t=Mt(this.file.relative);return"@import "+('"'+Ct+'/app.wxss";').replace(Et,Jt(t))+("\n"+e)}),{skipBinary:!1})).pipe(i.restore).pipe(jt.filter((function(e){if("unlink"===e.event){try{t.sync([e.path.replace(a.resolve(St,Nt),a.resolve(St,At))],{force:!0})}catch(e){}return!1}return!0}))).pipe(n.dest(At,{cwd:St}))}));const{cwd:Bt,env:Ot,targetPath:$t,subModePath:It,projectToSubPackageConfig:Ut,program:Ft}=j,{tryAgain:Tt}=L;n.task("mpWxSubMode",n.series((function(e){console.log("对uni-app进行解耦构建，解除uni-app对原生小程序方法的改写，此过程如果出现权限问题，请使用管理员权限运行"),e()}),"clean:previewDist",(async function e(t){if(Ft.plugin)t();else{try{let e={packPath:(Ut.subPackagePath?"/":"")+Ut.subPackagePath,appMode:Ut.appMode};await s.outputFile(It+"/pack.config.js","module.exports="+JSON.stringify(e,null,4))}catch(n){return void await Tt(async()=>{await e(t)})}t()}}),function(){let e=[async function(e){let t=a.resolve(Bt,Ut.mainWeixinMpPath,"app.js");await s.exists(t)||await s.outputFile(t,"App({});"),e()},"subMode:createUniSubPackage","subMode:copyWxResource",...Ft.plugin?["watch:pluginJson"]:["watch:baseAppJson","watch:pagesJson",...Ut.mergePack?["watch:mainWeixinMpPackPath"]:[],...It===$t?["watch:topMode-mainAppJsAndAppWxss"]:[]],"watch:mainAppJson","watch:mainWeixinMp","watch:projectConfigJson"];return"build"===Ot?n.series.apply(this,e):n.parallel.apply(this,e)}(),(function(e){e(),"build"===Ot&&process.exit()})));const{cwd:Dt,basePath:Ht,base:Kt}=j;n.task("startToPackServe",n.series((async function(e){await s.exists(Ht)||await s.mkdirs(Ht),e()}),"clean:base",(function(e){n.watch(Kt+"/app.json",{events:["all"],cwd:Dt},(function(){e()}))}),"mpWxSubMode")),process.on("unhandledRejection",()=>{});
